---
- name: Reload systemd
  ansible.builtin.systemd:
    daemon_reload: true

- name: Restart Valkey
  ansible.builtin.systemd:
    name: "{{ valkey_service_name }}"
    state: restarted

- name: Reload Valkey
  ansible.builtin.systemd:
    name: "{{ valkey_service_name }}"
    state: reloaded

- name: Update GRUB
  ansible.builtin.shell: |
    if command -v update-grub &> /dev/null; then
      update-grub
    else
      grub-mkconfig -o /boot/grub/grub.cfg
    fi

- name: Warn user about reboot requirement
  ansible.builtin.debug:
    msg: |
      WARNING: GRUB configuration has been updated with transparent_hugepage=madvise
      A REBOOT IS REQUIRED for this change to take effect permanently.
      The setting has been applied at runtime temporarily.
