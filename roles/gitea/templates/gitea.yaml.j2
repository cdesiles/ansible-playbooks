---
apiVersion: v1
kind: Pod
metadata:
  name: gitea
  labels:
    app: gitea
spec:
  containers:
    - name: server
      image: {{ gitea_image }}:{{ gitea_version }}
      ports:
        - containerPort: {{ gitea_port }}
          hostPort: {{ gitea_port }}
      env:
        - name: GITEA__database__DB_TYPE
          value: postgres
        - name: GITEA__database__HOST
          value: {{ immich_postgres_host | default('127.0.0.1') }}
        - name: GITEA__database__PORT
          value: "5432"
        - name: GITEA__database__NAME
          value: "{{ gitea_postgres_db_name }}"
        - name: GITEA__database__USER
          value: "{{ gitea_postgres_user }}"
        - name: GITEA__database__PASSWD
          value: "{{ gitea_postgres_password }}"
        - name: GITEA__server__DOMAIN
          value: "{{ gitea_domain }}"
        - name: GITEA__server__ROOT_URL
          value: "{{ gitea_root_url }}"
        - name: GITEA__server__HTTP_PORT
          value: "{{ gitea_port }}"
        - name: GITEA__server__DISABLE_SSH
          value: "{{ 'true' if gitea_disable_ssh else 'false' }}"
        - name: GITEA__service__DISABLE_REGISTRATION
          value: "{{ 'true' if gitea_disable_registration else 'false' }}"
      volumeMounts:
        - name: localtime
          mountPath: /etc/localtime
          readOnly: true
        - name: gitea-data
          mountPath: /data
      restartPolicy: Always

  volumes:
    - name: localtime
      hostPath:
        path: /etc/localtime
        type: File
    - name: gitea-data
      hostPath:
        path: {{ gitea_data_dir }}
        type: Directory
